<p-toast />
<div class="catgories-header-comp">
  <div class="catgories-info">
    <h1 class="catgories-title">My Orders</h1>
    <p class="catgories-subtitle">All my orders history till now</p>
  </div>
</div>

<div *ngIf="AllOrders.length === 0" class="no-buy-request">
  <h1>No order history yet</h1>
</div>

<div *ngIf="isLoading" class="loading-overlay">
  <app-loader [isLoading]="isLoading"></app-loader>
</div>

<div *ngFor="let order of AllOrders">
  <div class="orders-container">
    <div class="order-card">
      <div class="order-card-content">
        <div class="product-image-container">
          <img
            src="https://tse2.mm.bing.net/th/id/OIP.Yu0XkK0uGjoZ_1oQ7zZnsQHaFl?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3"
            alt="Product Name"
            class="product-image"
          />
          <div>
            <h3 class="product-title">{{ order.product.product.name }}</h3>
            <span class="product-category-badge">{{ order.product.category.name }}</span>
          </div>

          <span>{{ order.order.status | orderStatus }}</span>
        </div>

        <p class="product-description">
          {{ order.product.product.description }}
        </p>

        <div class="order-info-grid">
          <div class="order-info-item">
            <i class="pi pi-calendar"></i>
            <span>Start: {{ order.order.start_date.split('T')[0] }}</span>
          </div>
          <div class="order-info-item">
            <i class="pi pi-calendar"></i>
            <span>End: {{ order.order.end_date.split('T')[0] }}</span>
          </div>
          <div class="order-info-item">
            <i class="pi pi-users"></i>
            <span>Tenant: {{ order.product.user.full_name }}</span>
          </div>
          <div class="order-info-item">
            <i class="pi pi-indian-rupee"></i>
            <span>Total: â‚¹{{ order.order.total_amount }}/day</span>
          </div>
        </div>
      </div>
      <div class="action-buttons">
        <button
          *ngIf="loggedInUser?.role === 'user' && order.order.status === 2"
          class="feedback-btn"
          (click)="showFeedbackDialog(order.order.id)"
        >
          Give Feedback
        </button>
      </div>
    </div>
  </div>
</div>

<!-- PrimeNG Feedback Dialog -->
<p-dialog
  header="Give Feedback"
  [(visible)]="displayFeedbackDialog"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  <form (ngSubmit)="submitFeedback()" class="flex flex-col gap-4">
    <div class="flex flex-col items-center gap-2">
      <label class="font-bold">Rating</label>
      <p-rating [(ngModel)]="feedbackData.rating" required name="ratingValue" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-bold">Description</label>
      <textarea
        [(ngModel)]="feedbackData.description"
        name="description"
        rows="5"
        [maxlength]="150"
        pTextarea
        [autoResize]="true"
      ></textarea>
      <small class="text-right">{{ feedbackData.description.length || 0 }}/150</small>
    </div>

    <div class="flex justify-content-end gap-2">
      <p-button label="Cancel" severity="secondary" (onClick)="displayFeedbackDialog = false" />
      <p-button label="Submit" type="submit" />
    </div>
  </form>
</p-dialog>
